default_platform(:ios)

platform :ios do
  desc "Run test"
  lane :test do
    scan(
      devices: ["iPhone 13 Pro (15.2)"]
    )
  end

  desc "Fetch development certificates"
  lane :setup_development_certificates do
    match(
      app_identifier: ["moe.nnsnodnb.NowPlaying", "moe.nnsnodnb.NowPlaying.TodayExtension"]
    )
  end

  desc "Fetch adhoc certificates"
  lane :setup_adhoc_certificates do
    match(
      app_identifier: ["moe.nnsnodnb.NowPlaying", "moe.nnsnodnb.NowPlaying.TodayExtension"]
    )
  end

  desc "Archive & export NowPlaying.ipa for Development"
  lane :development do
    setup_adhoc_certificates

    gym(
      export_method: "ad-hoc",
      configuration: "Release",
      xcargs: "PROVISIONING_PROFILE_SPECIFIER='match AdHoc moe.nnsnodnb.NowPlaying'",
    )
  end

  lane :create_appicon do
    appicon(
      appicon_devices: [:iphone, :ios_marketing],
      appicon_path: "NowPlaying/Resources/Assets.xcassets"
    )
  end
end
